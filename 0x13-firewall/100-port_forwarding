#!/bin/bash

# Flush existing rules
iptables -F

# Set default policies
iptables -P INPUT DROP
iptables -P OUTPUT ACCEPT
iptables -P FORWARD DROP

# Allow established connections
iptables -A INPUT -m conntrack --ctstate ESTABLISHED,RELATED -j ACCEPT

# Allow loopback traffic
iptables -A INPUT -i lo -j ACCEPT

# Allow SSH (replace X.X.X.X with your own IP address)
iptables -A INPUT -p tcp -s 54.162.97.128 --dport 22 -j ACCEPT

# Port forwarding rule (forward incoming traffic on port 8080 to port 80)
iptables -t nat -A PREROUTING -p tcp --dport 8080 -j REDIRECT --to-port 80
# Save rules
iptables-save > /etc/iptables/rules.v4
